name: IPTVè‡ªåŠ¨æ›´æ–°

on:
  schedule:
    - cron: '0 21 * * *'  #ï¼ˆåŒ—äº¬æ—¶é—´5ç‚¹ï¼‰
  workflow_dispatch:      # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  update:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write
      pages: write
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v3
      
    - name: è¿è¡Œæ›´æ–°è„šæœ¬
      run: |
        chmod +x scripts/iptv_updater.sh
        scripts/iptv_updater.sh
      
    - name: æäº¤æ›´æ–°
      run: |
        # åªæœ‰å½“æ–‡ä»¶æœ‰å˜åŒ–æ—¶æ‰æäº¤
        if [ -f "docs/iptv.m3u8" ]; then
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add docs/
          
          # æ£€æŸ¥æ˜¯å¦æœ‰å®é™…å˜åŒ–
          if git diff --cached --quiet; then
            echo "æ–‡ä»¶æ— å˜åŒ–ï¼Œè·³è¿‡æäº¤"
          else
            git commit -m "ğŸ“º IPTVæ›´æ–°: $(date '+%Y-%m-%d %H:%M:%S')"
            git push
            echo "âœ… æ›´æ–°å·²æäº¤"
          fi
        else
          echo "âŒ è¾“å‡ºæ–‡ä»¶ä¸å­˜åœ¨ï¼Œè·³è¿‡æäº¤"
        fi
      
    - name: éƒ¨ç½²åˆ°GitHub Pages
      if: success()
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./docs
        publish_branch: gh-pages
        force_orphan: true
